{% extends 'base.html' %}

{% block content %}
<div class="card">
    <div class="card-header">
        <h5>Listado de Bodegas</h5>
        <div class="card-header-right">
            <button class="btn btn-primary btn-sm" data-toggle="modal" data-target="#createModal" style="font-size: 14px; border-radius: 20px; padding: 5px 15px;">
                <i class="ti-plus"></i> Nueva Bodega
            </button>
        </div>
    </div>
    
    <div class="card-block" style="padding: 20px 25px;">
        <div class="dt-responsive table-responsive" style="width: 100%;">
            <table id="warehouses-table" class="table table-striped table-bordered nowrap" style="width:100%">
                <thead>
                    <tr>
                        <th class="text-center">Nombre</th>
                        <th class="text-center">Teléfono</th>
                        <th class="text-center">Email</th>
                        <th class="text-center">Ubicación</th>
                        <th class="text-center">Capacidad</th>
                        <th class="text-center">Horario</th>
                        <th class="text-center" style="width: 180px;">Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    {% for bodega in warehouses %}
                    <tr>
                        <td>{{ bodega.name }}</td>
                        <td>{{ bodega.phone }}</td>
                        <td>{{ bodega.email }}</td>
                        <td>{{ bodega.location }}</td>
                        <td>{{ bodega.max_capacity }}</td>
                        <td>{{ bodega.open_hours }}</td>
                        <td class="text-center">
                            <div class="btn-group" role="group">
                                <button class="btn btn-sm" data-toggle="modal" data-target="#editModal-{{ bodega.id }}" 
                                        title="Editar" style="background-color: #E3F2FD; color: #1976D2; border-radius: 15px; border: 1px solid #BBDEFB;">
                                    <i class="ti-pencil"></i>
                                </button>
                                <button class="btn btn-sm" data-toggle="modal" data-target="#deleteModal-{{ bodega.id }}" 
                                        title="Eliminar" style="background-color: #FFEBEE; color: #D32F2F; border-radius: 15px; border: 1px solid #FFCDD2;">
                                    <i class="ti-trash"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="7" class="text-center">No hay bodegas registradas.</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Modal Crear -->
<div class="modal fade" id="createModal" tabindex="-1" role="dialog" aria-labelledby="createModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <form method="POST" action="{% url 'warehouse-create' %}" class="modal-content">
        {% csrf_token %}
        <div class="modal-header">
            <h5 class="modal-title" id="createModalLabel">Nueva Bodega</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Cerrar">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>
        <div class="modal-body">
            {% include "warehouse_form.html" %}
        </div>
        <div class="modal-footer">
            <button type="submit" class="btn btn-primary" style="border-radius: 20px; padding: 5px 20px;">
                <i class="ti-save"></i> Crear
            </button>
        </div>
    </form>
  </div>
</div>

<!-- Modales individuales -->
{% for bodega in warehouses %}
<!-- Modal Editar -->
<div class="modal fade" id="editModal-{{ bodega.id }}" tabindex="-1" role="dialog" aria-labelledby="editModalLabel-{{ bodega.id }}" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <form method="POST" action="{% url 'warehouse-edit' bodega.id %}" class="modal-content">
        {% csrf_token %}
        <div class="modal-header">
            <h5 class="modal-title" id="editModalLabel-{{ bodega.id }}">Editar Bodega</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Cerrar">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>
        <div class="modal-body">
            {% include "warehouse_form.html" with bodega=bodega %}
        </div>
        <div class="modal-footer">
            <button type="submit" class="btn btn-primary" style="border-radius: 20px; padding: 5px 20px;">
                <i class="ti-save"></i> Guardar
            </button>
        </div>
    </form>
  </div>
</div>

<!-- Modal Eliminar -->
<div class="modal fade" id="deleteModal-{{ bodega.id }}" tabindex="-1" role="dialog" aria-labelledby="deleteModalLabel-{{ bodega.id }}" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <form method="POST" action="{% url 'warehouse-delete' bodega.id %}" class="modal-content">
        {% csrf_token %}
        <div class="modal-header">
            <h5 class="modal-title" id="deleteModalLabel-{{ bodega.id }}">Eliminar Bodega</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Cerrar">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>
        <div class="modal-body">
            ¿Estás seguro que deseas eliminar la bodega <strong>{{ bodega.name }}</strong>?
        </div>
        <div class="modal-footer">
            <button type="submit" class="btn btn-danger" style="border-radius: 20px; padding: 5px 20px;">
                <i class="ti-trash"></i> Eliminar
            </button>
            <button type="button" class="btn btn-secondary" data-dismiss="modal" style="border-radius: 20px; padding: 5px 20px;">
                <i class="ti-close"></i> Cancelar
            </button>
        </div>
    </form>
  </div>
</div>
{% endfor %}

<style>
    .card-block {
        padding: 1.25rem;
    }
    #warehouses-table {
        margin: 0;
    }
    #warehouses-table th {
        white-space: nowrap;
        background-color: #f8f9fa;
    }
    .btn-group .btn {
        margin-right: 5px;
        padding: 3px 10px;
        font-size: 13px;
        transition: all 0.3s ease;
    }
    .btn-group .btn:hover {
        opacity: 0.8;
        transform: translateY(-1px);
    }
    .btn-group .btn:last-child {
        margin-right: 0;
    }
    .modal-footer .btn {
        margin-right: 10px;
    }
    .modal-footer .btn:last-child {
        margin-right: 0;
    }
</style>

{% endblock %}