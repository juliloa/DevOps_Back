{% extends 'base.html' %}

{% block content %}
<div class="flex min-h-screen">

<!-- Sidebar lateral izquierdo -->
<aside class="w-64 bg-white text-black p-6 space-y-6 hidden md:block">


    <h2 class="text-2xl font-bold mb-6">Filtros</h2>

    <!-- Filtro Categoría -->
    <div>
    <label for="category-filter" class="block font-semibold mb-2">Categoría:</label>
    <select id="category-filter" onchange="window.location.href=this.value" class="w-full p-2 rounded text-black">
        <option value="" selected>Todos</option>
        <option value="{% url 'product-category-filter' category_id=1 %}">Ropa</option>
        <option value="{% url 'product-category-filter' category_id=2 %}">Tecnología</option>
    </select>
    </div>

    <!-- Filtro Bodega -->
    <div>
    <label for="warehouse-filter" class="block font-semibold mb-2">Bodega:</label>
    <select id="warehouse-filter" onchange="window.location.href=this.value" class="w-full p-2 rounded text-black">
        <option value="" selected>Todas</option>
        <option value="{% url 'product-warehouse-filter' warehouse_id=1 %}">Envigado</option>
        <option value="{% url 'product-warehouse-filter' warehouse_id=2 %}">Sabaneta</option>
        <option value="{% url 'product-warehouse-filter' warehouse_id=3 %}">Itagüí</option>
        <option value="{% url 'product-warehouse-filter' warehouse_id=4 %}">El Poblado</option>
        <option value="{% url 'product-warehouse-filter' warehouse_id=5 %}">Bello</option>
        <option value="{% url 'product-warehouse-filter' warehouse_id=6 %}">Girardota</option>
    </select>
    </div>

    <!-- Filtro Precio -->
    <form method="get" action="{% url 'product-price-filter' %}" class="space-y-2">
    <label for="min_price" class="block font-semibold">Precio mínimo:</label>
    <input type="number" step="0.01" name="min_price" id="min_price" class="w-full p-2 rounded text-black" value="{{ request.GET.min_price }}">
    <label for="max_price" class="block font-semibold">Precio máximo:</label>
    <input type="number" step="0.01" name="max_price" id="max_price" class="w-full p-2 rounded text-black" value="{{ request.GET.max_price }}">
    <button type="submit" class="bg-blue-500 text-white w-full py-2 rounded mt-2 hover:bg-blue-600">Filtrar</button>
    </form>

    <!-- Filtros Atributos -->
    <form method="get" action="{% url 'product-filter-attributes' %}" class="space-y-4 mt-6">
    {% for atributo, valores in atributos_values.items %}
    <div>
        <button type="button" class="w-full text-left font-semibold" onclick="this.nextElementSibling.classList.toggle('hidden')">
        {{ atributo|title }}
        </button>
        <div class="hidden mt-2">
        {% for value in valores %}
        <label class="flex items-center space-x-2 text-sm">
            <input type="checkbox" name="{{ atributo }}" value="{{ value }}" class="form-checkbox text-blue-600">
            <span>{{ value }}</span>
        </label>
        {% endfor %}
        </div>
    </div>
    {% endfor %}
    <button type="submit" class="bg-blue-500 text-white w-full py-2 rounded hover:bg-blue-600">Filtrar</button>
    </form>
</aside>

<!-- Contenido principal -->
<main class="flex-1 p-6">
    <div class="flex justify-between items-center mb-6">
    {% if categoria_seleccionada %}
    <p class="text-gray-700 mb-4">
        Mostrando productos en la categoría: <span class="font-semibold">{{ categoria_seleccionada.name }}</span>
    </p>
    {% elif bodega_seleccionada %}
    <p class="text-gray-700 mb-4">
        Mostrando productos en: <span class="font-semibold">{{ bodega_seleccionada.name }}</span>
    </p>
    {% elif min_price %}
    <p class="text-gray-700 mb-4">
        Mostrando productos con precio desde <span class="font-semibold">${{ min_price }}</span>
        {% if max_price %} hasta <span class="font-semibold">${{ max_price }}</span>{% endif %}
    </p>
    {% else %}
    <h1 class="text-3xl font-semibold">Catálogo de Productos</h1>
    {% endif %}
    {% if request.user.role.name|lower == "administrador" %}
    <a href="{% url 'product-create' %}" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">+ Agregar producto</a>
    {% endif %}
    </div>

    <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
    {% for producto in productos %}
    <div class="bg-white p-4 rounded-lg shadow-md hover:shadow-lg transition-all">
        <img src="{{ producto.image_url }}" alt="{{ producto.name }}" class="w-full h-48 object-cover rounded-lg mb-4">
        <h2 class="text-xl font-semibold">{{ producto.name }}</h2>
        <p class="text-gray-600 text-sm mb-4">{{ producto.description }}</p>
        <p class="text-lg font-bold">Categoría: {{ producto.category.name }}</p>
        {% if producto.variants.all %}
        <p class="text-lg font-bold text-green-600 mt-4">Precio: ${{ producto.variants.first.price|floatformat:2 }}</p>
        {% else %}
        <p class="text-lg font-bold text-red-600 mt-4">Sin precio disponible</p>
        {% endif %}
        <div class="mt-4 flex justify-between items-center">
          <a href="{% url 'product-detail' producto.id %}" class="text-blue-600 font-semibold hover:underline">
            Ver producto
          </a>
          {% if request.user.role.name|lower == "administrador" %}
          <div class="mt-2 flex gap-3">
            <a href="{% url 'product-edit' producto.id %}" class="text-yellow-600 hover:underline">Editar</a>
            <form action="{% url 'product-delete' producto.id %}" method="post" onsubmit="return confirm('¿Eliminar este producto?')">
              {% csrf_token %}
              <button type="submit" class="text-red-600 hover:underline">Eliminar</button>
            </form>
          </div>
          {% endif %}
        </div>
      </div>
      {% endfor %}
    </div>
  </main>

</div>
{% endblock %}
